Im# Revis√£o do Fluxo de Processos

## üìä Vis√£o Geral da Arquitetura

### Estrutura de Telas

- `/dashboard/processos` - Lista de processos acompanhados
- `/dashboard/processos/[id]` - Detalhes de um processo espec√≠fico

### Estrutura de Endpoints

- `GET /api/processos` - Listar processos do usu√°rio
- `POST /api/processos` - Adicionar novo processo
- `GET /api/processos/[id]` - Buscar processo espec√≠fico
- `PATCH /api/processos/[id]` - Editar acompanhamento
- `DELETE /api/processos/[id]` - Remover acompanhamento
- `POST /api/processos/[id]/atualizar-datajud` - Atualizar dados do DataJud

---

## ‚úÖ Pontos Positivos

### 1. Arquitetura Bem Estruturada

- Separa√ß√£o clara entre `processes` (dados globais) e `user_processes` (acompanhamentos)
- Uso de Supabase Admin para bypass de RLS onde necess√°rio
- Schemas Zod para valida√ß√£o consistente

### 2. Tratamento de Erros Robusto

- Logging adequado em todos os endpoints
- Mensagens de erro claras para o usu√°rio
- Try-catch em todas as opera√ß√µes cr√≠ticas

### 3. UX Bem Pensada

- Estados de loading claros
- Feedback toast para a√ß√µes
- Empty states informativos
- Cards de estat√≠sticas na listagem

### 4. Componentiza√ß√£o Adequada

- Di√°logos reutiliz√°veis (Add, Edit, Delete)
- Tabela isolada em componente pr√≥prio
- Uso de shadcn/ui para consist√™ncia

---

## üî¥ Problemas Cr√≠ticos

### 1. **Duplica√ß√£o de Campos no Retorno da API**

**Localiza√ß√£o:** `app/api/processos/route.ts` (linhas 131-152)

```typescript
const processos = (userProcesses || []).map((up: any) => ({
  id: up.id,
  process_id: up.processes?.id,
  numero: up.processes?.numero,
  tribunal: up.processes?.tribunal,
  apelido: up.apelido,
  notificar: up.notificar,
  created_at: up.criado_em, // ‚ùå Duplicado
  updated_at: up.atualizado_em, // ‚ùå Duplicado
  criado_em: up.criado_em, // ‚ùå Duplicado
  atualizado_em: up.atualizado_em, // ‚ùå Duplicado
  // ...
}));
```

**Impacto:** Confus√£o no frontend sobre qual campo usar

**Solu√ß√£o:** Padronizar em snake_case ou camelCase

---

### 2. **Verifica√ß√£o de Processo Existente com Falha de JOIN**

**Localiza√ß√£o:** `app/api/processos/route.ts` (linhas 221-227)

```typescript
const { data: existingUserProcess } = await supabase
  .from("user_processes")
  .select("id, processes(numero)")
  .eq("user_id", internalUserId)
  .eq("processes.numero", numero) // ‚ùå Isso pode n√£o funcionar corretamente
  .maybeSingle();
```

**Problema:** O filtro em JOIN pode n√£o funcionar como esperado no Supabase

**Solu√ß√£o Recomendada:**

```typescript
// 1. Buscar o processo na tabela global
const { data: existingProcess } = await supabaseAdmin
  .from("processes")
  .select("id")
  .eq("numero", numero)
  .maybeSingle();

// 2. Se existir, verificar se o usu√°rio j√° acompanha
if (existingProcess) {
  const { data: userProcess } = await supabaseAdmin
    .from("user_processes")
    .select("id")
    .eq("user_id", internalUserId)
    .eq("process_id", existingProcess.id)
    .maybeSingle();

  if (userProcess) {
    return NextResponse.json(
      { error: "Voc√™ j√° acompanha este processo" },
      { status: 409 }
    );
  }
}
```

---

### 3. **Fun√ß√£o Duplicada de Busca DataJud**

**Problema:** A fun√ß√£o `buscarDadosDataJud` est√° implementada em:

- `app/api/processos/route.ts` (linhas 10-51)
- `lib/datajud.ts` (presumivelmente, j√° que √© importada na p√°gina de detalhes)

**Impacto:** C√≥digo duplicado, dif√≠cil manuten√ß√£o

**Solu√ß√£o:** Usar apenas a fun√ß√£o de `lib/datajud.ts`

---

### 4. **Busca DataJud no Cliente**

**Localiza√ß√£o:** `app/dashboard/processos/[id]/page.tsx` (linha 79)

```typescript
const resultado = await buscarProcesso(processo.numero);
```

**Problema:** API key do DataJud exposta no cliente

**Solu√ß√£o:** Mover para o endpoint `/api/processos/[id]/atualizar-datajud`

```typescript
// Cliente apenas chama:
const response = await fetch(`/api/processos/${id}/atualizar-datajud`, {
  method: "POST",
  body: JSON.stringify({ numero: processo.numero }),
});

// Backend faz a busca no DataJud
```

---

### 5. **Falta de Debounce/Throttle na Atualiza√ß√£o DataJud**

**Problema:** Usu√°rio pode clicar m√∫ltiplas vezes no bot√£o de atualizar

**Solu√ß√£o:** Adicionar debounce ou cooldown

```typescript
const [lastUpdate, setLastUpdate] = useState<Date | null>(null);
const COOLDOWN_MS = 30000; // 30 segundos

const atualizarProcessoDataJud = async () => {
  if (lastUpdate && Date.now() - lastUpdate.getTime() < COOLDOWN_MS) {
    toast.error("Aguarde antes de atualizar novamente");
    return;
  }

  setLastUpdate(new Date());
  // ... resto do c√≥digo
};
```

---

## ‚ö†Ô∏è Problemas de Performance

### 6. **JOIN Pesado na Listagem**

**Localiza√ß√£o:** `app/api/processos/route.ts` (linhas 89-118)

```typescript
const { data: userProcesses } = await supabaseAdmin.from("user_processes")
  .select(`
    id,
    apelido,
    notificar,
    criado_em,
    atualizado_em,
    processes (
      id,
      numero,
      tribunal,
      partes,
      ultima_movimentacao,
      atualizado_em,
      classe,
      sistema,
      formato,
      data_ajuizamento,
      grau,
      orgao_julgador,
      assuntos,
      movimentos  // ‚ùå Isso pode ser MUITO pesado
    )
  `);
```

**Problema:** O campo `movimentos` pode ter dezenas/centenas de itens

**Solu√ß√£o:** Criar dois endpoints:

- `GET /api/processos` - Retorna resumo (sem movimentos)
- `GET /api/processos/[id]` - Retorna detalhes completos

---

### 7. **Falta de Pagina√ß√£o**

**Problema:** Se o usu√°rio acompanhar 100+ processos, a tela ficar√° lenta

**Solu√ß√£o:** Implementar pagina√ß√£o server-side

```typescript
// Endpoint
export async function GET(req: NextRequest) {
  const { searchParams } = new URL(req.url);
  const page = parseInt(searchParams.get("page") || "1");
  const limit = parseInt(searchParams.get("limit") || "20");
  const offset = (page - 1) * limit;

  const { data, count } = await supabaseAdmin
    .from("user_processes")
    .select("*", { count: "exact" })
    .range(offset, offset + limit - 1);

  return NextResponse.json({
    processos: data,
    pagination: {
      page,
      limit,
      total: count,
      totalPages: Math.ceil((count || 0) / limit),
    },
  });
}
```

---

## üéØ Melhorias de UX

### 8. **Falta de Filtros e Busca**

**Problema:** Dif√≠cil encontrar processo espec√≠fico em lista grande

**Solu√ß√£o:** Adicionar filtros:

- Busca por n√∫mero/apelido
- Filtro por tribunal
- Filtro por notifica√ß√µes ativas/desativas
- Ordena√ß√£o por √∫ltima atualiza√ß√£o/data adi√ß√£o

---

### 9. **Loading States Inconsistentes**

**Problema:** Na p√°gina de detalhes, n√£o h√° skeleton loader

**Solu√ß√£o:** Usar `ProcessSkeleton` ou criar novo skeleton espec√≠fico

---

### 10. **Falta de Confirma√ß√£o ao Sair com Edi√ß√£o**

**Problema:** Usu√°rio pode perder dados ao fechar o dialog sem salvar

**Solu√ß√£o:** Adicionar `beforeunload` ou verifica√ß√£o de form dirty

```typescript
const {
  formState: { isDirty },
} = useForm();

const handleOpenChange = (newOpen: boolean) => {
  if (!newOpen && isDirty && !isLoading) {
    if (!confirm("Descartar altera√ß√µes?")) {
      return;
    }
  }
  setOpen(newOpen);
};
```

---

## üîí Problemas de Seguran√ßa

### 11. **API Key Hardcoded**

**Localiza√ß√£o:** `app/api/processos/route.ts` (linhas 27-28)

```typescript
Authorization: "APIKey cDZHYzlZa0JadVREZDJCendQbXY6SkJlTzNjLV9TRENyQk1RdnFKZGRQdw==";
```

**Solu√ß√£o:** Mover para vari√°vel de ambiente

```typescript
Authorization: `APIKey ${process.env.DATAJUD_API_KEY}`;
```

---

### 12. **Falta de Rate Limiting**

**Problema:** Usu√°rio pode fazer spam de requisi√ß√µes √† API

**Solu√ß√£o:** Implementar rate limiting com Upstash ou middleware Next.js

---

## üìã Melhorias de C√≥digo

### 13. **Type Safety Melhor√°vel**

**Problema:** Uso de `any` em v√°rios lugares

```typescript
const processos = (userProcesses || []).map((up: any) => ({ // ‚ùå
```

**Solu√ß√£o:** Criar interfaces TypeScript adequadas

```typescript
interface UserProcessWithProcess {
  id: string;
  apelido: string | null;
  notificar: boolean;
  criado_em: string;
  atualizado_em: string;
  processes: {
    id: string;
    numero: string;
    tribunal: string;
    // ...
  };
}

const processos = (userProcesses || []).map((up: UserProcessWithProcess) => ({
```

---

### 14. **Falta de Testes**

**Problema:** Sem testes unit√°rios ou de integra√ß√£o

**Solu√ß√£o:** Adicionar testes para:

- Schemas Zod
- Endpoints da API
- Componentes de UI
- Fluxos completos

---

### 15. **C√≥digo Duplicado de Autentica√ß√£o**

**Problema:** Todo endpoint repete o mesmo c√≥digo de auth

**Solu√ß√£o:** Criar middleware ou helper

```typescript
// lib/api-helpers.ts
export async function getAuthenticatedUser() {
  const supabase = await createClient();
  const {
    data: { user },
    error: authError,
  } = await supabase.auth.getUser();

  if (authError || !user) {
    throw new Error("N√£o autorizado");
  }

  const { data: userData, error: userError } = await supabase
    .from("users")
    .select("id")
    .eq("auth_user_id", user.id)
    .maybeSingle();

  if (userError || !userData) {
    throw new Error("Usu√°rio n√£o encontrado");
  }

  return { authUser: user, internalUserId: userData.id };
}

// Uso:
export async function GET(req: NextRequest) {
  try {
    const { internalUserId } = await getAuthenticatedUser();
    // ... resto do c√≥digo
  } catch (error) {
    return NextResponse.json({ error: error.message }, { status: 401 });
  }
}
```

---

## üöÄ Novas Funcionalidades Sugeridas

### 16. **Cache de Dados do DataJud**

Evitar chamadas repetidas √† API externa:

```typescript
// Adicionar campo na tabela processes:
// datajud_updated_at TIMESTAMP

// S√≥ buscar se passou mais de X horas:
const CACHE_HOURS = 24;
const needsUpdate =
  !processo.datajud_updated_at ||
  Date.now() - new Date(processo.datajud_updated_at).getTime() >
    CACHE_HOURS * 3600000;
```

---

### 17. **Sincroniza√ß√£o Autom√°tica em Background**

Atualizar processos automaticamente via Cron Job:

```typescript
// app/api/cron/sync-processos/route.ts
export async function GET() {
  // Verificar secret do Vercel Cron
  // Buscar todos os processos com notificar=true
  // Atualizar dados do DataJud
  // Enviar notifica√ß√µes se houver mudan√ßas
}
```

---

### 18. **Notifica√ß√µes de Movimenta√ß√µes**

Implementar sistema de diff e notifica√ß√µes:

```typescript
// Comparar movimentos antigos com novos
const novosMovimentos = novosDados.movimentos.filter(
  (m) => !dadosAntigos.movimentos.some((old) => old.dataHora === m.dataHora)
);

// Enviar email/push se houver novos movimentos
if (novosMovimentos.length > 0 && processo.notificar) {
  await sendNotification(user.email, {
    processo: processo.numero,
    movimentos: novosMovimentos,
  });
}
```

---

### 19. **Export de Dados**

Permitir exportar lista de processos em PDF/CSV:

```typescript
// Componente
<Button onClick={exportToPDF}>
  <Download className="mr-2" />
  Exportar PDF
</Button>
```

---

### 20. **Timeline Visual**

Criar visualiza√ß√£o de movimenta√ß√µes em timeline:

```typescript
// Componente TimelineProcesso
{
  processo.movimentos?.map((mov, idx) => (
    <TimelineItem
      key={idx}
      date={mov.dataHora}
      title={mov.nome}
      description={mov.complementosTabelados}
    />
  ));
}
```

---

## üìù Checklist de Refatora√ß√£o Priorit√°ria

### Prioridade Alta üî¥

- [ ] Remover busca DataJud do cliente (item #4)
- [ ] Mover API key para .env (item #11)
- [ ] Corrigir verifica√ß√£o de processo existente (item #2)
- [ ] Remover fun√ß√£o duplicada buscarDadosDataJud (item #3)

### Prioridade M√©dia üü°

- [ ] Padronizar nomes de campos na API (item #1)
- [ ] Otimizar JOIN na listagem (item #6)
- [ ] Adicionar pagina√ß√£o (item #7)
- [ ] Criar helper de autentica√ß√£o (item #15)
- [ ] Adicionar rate limiting (item #12)

### Prioridade Baixa üü¢

- [ ] Adicionar filtros e busca (item #8)
- [ ] Melhorar loading states (item #9)
- [ ] Adicionar confirma√ß√£o ao sair (item #10)
- [ ] Implementar testes (item #14)
- [ ] Adicionar novas funcionalidades (#16-20)

---

## üèóÔ∏è Arquitetura Recomendada (Melhorada)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENTE (Next.js)                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  /dashboard/processos                                    ‚îÇ
‚îÇ    ‚îú‚îÄ ProcessosTable (resumo, sem movimentos)           ‚îÇ
‚îÇ    ‚îú‚îÄ AddProcessoDialog                                 ‚îÇ
‚îÇ    ‚îî‚îÄ Filtros/Busca                                     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  /dashboard/processos/[id]                              ‚îÇ
‚îÇ    ‚îú‚îÄ Informa√ß√µes completas                             ‚îÇ
‚îÇ    ‚îú‚îÄ Timeline de movimenta√ß√µes                         ‚îÇ
‚îÇ    ‚îî‚îÄ Bot√£o de atualiza√ß√£o (com cooldown)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   API ROUTES (Next.js)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  GET  /api/processos                                     ‚îÇ
‚îÇ       ‚îî‚îÄ Lista resumida (paginada, sem movimentos)      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  POST /api/processos                                     ‚îÇ
‚îÇ       ‚îî‚îÄ Adiciona processo + busca DataJud (server)     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  GET  /api/processos/[id]                               ‚îÇ
‚îÇ       ‚îî‚îÄ Detalhes completos (com movimentos)            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  PATCH /api/processos/[id]                              ‚îÇ
‚îÇ       ‚îî‚îÄ Atualiza apelido/notifica√ß√µes                  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  DELETE /api/processos/[id]                             ‚îÇ
‚îÇ       ‚îî‚îÄ Remove acompanhamento                          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  POST /api/processos/[id]/atualizar-datajud            ‚îÇ
‚îÇ       ‚îî‚îÄ Busca DataJud no server (n√£o no cliente!)     ‚îÇ
‚îÇ       ‚îî‚îÄ Implementa rate limiting (1x a cada 30s)      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  GET /api/cron/sync-processos (novo)                   ‚îÇ
‚îÇ       ‚îî‚îÄ Atualiza todos processos com notificar=true   ‚îÇ
‚îÇ       ‚îî‚îÄ Envia notifica√ß√µes de novas movimenta√ß√µes     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  LIB/HELPERS                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  lib/auth-helpers.ts (novo)                             ‚îÇ
‚îÇ    ‚îî‚îÄ getAuthenticatedUser()                            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  lib/datajud.ts                                         ‚îÇ
‚îÇ    ‚îî‚îÄ buscarProcesso() - √∫nica implementa√ß√£o            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  lib/rate-limit.ts (novo)                              ‚îÇ
‚îÇ    ‚îî‚îÄ checkRateLimit()                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  BANCO DE DADOS                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  processes                                               ‚îÇ
‚îÇ    ‚îú‚îÄ datajud_updated_at (novo)                        ‚îÇ
‚îÇ    ‚îî‚îÄ movimentos (apenas em detalhes)                  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  user_processes                                         ‚îÇ
‚îÇ    ‚îî‚îÄ (sem mudan√ßas)                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéì Conclus√£o

O fluxo atual est√° funcional e bem estruturado, mas h√° espa√ßo para melhorias significativas em:

1. **Seguran√ßa** - API key exposta no cliente
2. **Performance** - JOINs pesados e falta de pagina√ß√£o
3. **Manutenibilidade** - C√≥digo duplicado de auth e busca DataJud
4. **UX** - Falta de filtros, busca e rate limiting visual

Recomendo implementar as melhorias na ordem da prioridade listada acima.
