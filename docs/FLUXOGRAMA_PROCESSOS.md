# Fluxograma - Sistema de Processos

## ğŸ“‹ Legenda

- ğŸ–¥ï¸ Tela/PÃ¡gina
- ğŸ”Œ Endpoint API
- ğŸ“¦ Componente
- ğŸ—„ï¸ Banco de Dados
- âš ï¸ Problema Identificado

---

## 1. Fluxo de Listagem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos (page.tsx)                â”‚
â”‚                                                     â”‚
â”‚  Estado:                                            â”‚
â”‚  â€¢ processos: ProcessoAcompanhado[]                â”‚
â”‚  â€¢ loading: boolean                                â”‚
â”‚  â€¢ error: string | null                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ useEffect + fetchProcessos()
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ GET /api/processos (route.ts)                   â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio (Supabase Auth)              â”‚
â”‚  2. Busca user_id interno (tabela users)           â”‚
â”‚  3. Query JOIN user_processes + processes           â”‚
â”‚  âš ï¸ PROBLEMA: Traz campo movimentos (pesado)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ supabaseAdmin.from('user_processes')
                   â”‚               .select('*, processes(*)')
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—„ï¸ BANCO DE DADOS                                 â”‚
â”‚                                                     â”‚
â”‚  user_processes                   processes         â”‚
â”‚  â”œâ”€ id                           â”œâ”€ id             â”‚
â”‚  â”œâ”€ user_id      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”œâ”€ numero         â”‚
â”‚  â”œâ”€ process_id â”€â”€â”˜               â”œâ”€ tribunal       â”‚
â”‚  â”œâ”€ apelido                      â”œâ”€ partes         â”‚
â”‚  â””â”€ notificar                    â”œâ”€ movimentos âš ï¸  â”‚
â”‚                                  â””â”€ classe...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { processos: [...] }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos                           â”‚
â”‚                                                     â”‚
â”‚  Renderiza:                                         â”‚
â”‚  â”œâ”€ Cards de EstatÃ­sticas                          â”‚
â”‚  â”‚  â”œâ”€ Total de Processos                          â”‚
â”‚  â”‚  â”œâ”€ Com NotificaÃ§Ãµes                            â”‚
â”‚  â”‚  â””â”€ Tribunais Ãšnicos                            â”‚
â”‚  â”‚                                                  â”‚
â”‚  â””â”€ ğŸ“¦ ProcessosTable                              â”‚
â”‚     â”œâ”€ Lista processos em tabela                   â”‚
â”‚     â”œâ”€ ğŸ“¦ EditProcessoDialog (por linha)          â”‚
â”‚     â””â”€ ğŸ“¦ DeleteProcessoDialog (por linha)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Fluxo de AdiÃ§Ã£o de Processo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos                           â”‚
â”‚                                                     â”‚
â”‚  UsuÃ¡rio clica:                                     â”‚
â”‚  [+ Acompanhar Processo]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ onClick
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ AddProcessoDialog                               â”‚
â”‚                                                     â”‚
â”‚  Form:                                              â”‚
â”‚  â€¢ NÃºmero do Processo (required)                   â”‚
â”‚  â€¢ Tribunal (required)                             â”‚
â”‚  â€¢ Apelido (optional)                              â”‚
â”‚  â€¢ Notificar (switch, default: true)               â”‚
â”‚                                                     â”‚
â”‚  ValidaÃ§Ã£o: addProcessoSchema (Zod)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ onSubmit â†’ POST /api/processos
                   â”‚ Body: { numero, tribunal, apelido, notificar }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ POST /api/processos (route.ts)                  â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio                              â”‚
â”‚  2. Valida input com Zod                           â”‚
â”‚  3. âš ï¸ Verifica se jÃ¡ acompanha (JOIN problemÃ¡tico)â”‚
â”‚  4. Verifica se processo existe na tabela global   â”‚
â”‚  5. Se NÃƒO existe:                                 â”‚
â”‚     â”œâ”€ buscarDadosDataJud(numero) âš ï¸ duplicada    â”‚
â”‚     â””â”€ Cria novo em processes                      â”‚
â”‚  6. Cria vÃ­nculo em user_processes                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ (Se processo nÃ£o existe)
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ buscarDadosDataJud() [INTERNO]                 â”‚
â”‚                                                     â”‚
â”‚  1. Limpa nÃºmero (remove formataÃ§Ã£o)               â”‚
â”‚  2. Monta query Elasticsearch                      â”‚
â”‚  3. POST para API DataJud                          â”‚
â”‚  âš ï¸ PROBLEMA: API Key hardcoded                    â”‚
â”‚     "APIKey cDZHYzlZa0JadVREZDJ..."                â”‚
â”‚  4. Retorna dados ou null                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Dados do processo
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—„ï¸ INSERT em processes                            â”‚
â”‚                                                     â”‚
â”‚  {                                                  â”‚
â”‚    numero, tribunal,                               â”‚
â”‚    partes: dadosDataJud?.partes || {},            â”‚
â”‚    ultima_movimentacao: {...},                     â”‚
â”‚    classe, sistema, formato,                       â”‚
â”‚    data_ajuizamento, grau,                         â”‚
â”‚    orgao_julgador, assuntos,                       â”‚
â”‚    movimentos: dadosDataJud?.movimentos           â”‚
â”‚  }                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—„ï¸ INSERT em user_processes                       â”‚
â”‚                                                     â”‚
â”‚  {                                                  â”‚
â”‚    user_id: internalUserId,                        â”‚
â”‚    process_id: processId,                          â”‚
â”‚    apelido, notificar                              â”‚
â”‚  }                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { processo: {...} }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ AddProcessoDialog                               â”‚
â”‚                                                     â”‚
â”‚  â€¢ toast.success("Processo adicionado!")           â”‚
â”‚  â€¢ reset() form                                    â”‚
â”‚  â€¢ setOpen(false)                                  â”‚
â”‚  â€¢ onSuccess() â†’ fetchProcessos()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Lista atualizada
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos                           â”‚
â”‚                                                     â”‚
â”‚  Processo aparece na tabela                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Fluxo de Detalhes do Processo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos                           â”‚
â”‚                                                     â”‚
â”‚  ğŸ“¦ ProcessosTable                                 â”‚
â”‚  â”œâ”€ Linha clicÃ¡vel                                 â”‚
â”‚  â””â”€ onClick â†’ router.push(`/processos/${id}`)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ NavegaÃ§Ã£o
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos/[id] (page.tsx)          â”‚
â”‚                                                     â”‚
â”‚  Estado:                                            â”‚
â”‚  â€¢ processo: ProcessoAcompanhado | null            â”‚
â”‚  â€¢ loading: boolean                                â”‚
â”‚  â€¢ updating: boolean                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ useEffect + fetchProcesso()
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ GET /api/processos/[id] (route.ts)             â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio                              â”‚
â”‚  2. Query user_processes JOIN processes            â”‚
â”‚  3. Verifica se pertence ao usuÃ¡rio                â”‚
â”‚  4. Retorna dados completos (com movimentos)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { processo: {...} }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos/[id]                      â”‚
â”‚                                                     â”‚
â”‚  Renderiza:                                         â”‚
â”‚  â”œâ”€ Header com botÃ£o "Voltar"                      â”‚
â”‚  â”œâ”€ BotÃ£o [Atualizar do DataJud] â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”œâ”€ Card: InformaÃ§Ãµes Principais          â”‚        â”‚
â”‚  â”œâ”€ Card: Assuntos                        â”‚        â”‚
â”‚  â”œâ”€ Card: Partes                          â”‚        â”‚
â”‚  â””â”€ Card: MovimentaÃ§Ãµes (timeline)        â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                          onClick           â”‚
                    atualizarProcessoDataJudâ”‚
                                            â”‚
                                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ âš ï¸ PROBLEMA CRÃTICO            â”‚
                    â”‚                                â”‚
                    â”‚ Busca no CLIENTE:              â”‚
                    â”‚ const resultado =              â”‚
                    â”‚   await buscarProcesso(numero) â”‚
                    â”‚                                â”‚
                    â”‚ ExpÃµe API key no browser!      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Dados do DataJud
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ POST /api/processos/[id]/atualizar-datajud     â”‚
â”‚                                                     â”‚
â”‚  Body: { dadosDataJud }                            â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio                              â”‚
â”‚  2. Verifica ownership do processo                 â”‚
â”‚  3. UPDATE em processes com novos dados            â”‚
â”‚  4. UPDATE timestamp em user_processes             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { success: true }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ /dashboard/processos/[id]                      â”‚
â”‚                                                     â”‚
â”‚  â€¢ toast.success("Atualizado!")                    â”‚
â”‚  â€¢ fetchProcesso() â†’ Recarrega dados               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Fluxo de EdiÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ProcessosTable - Linha do processo             â”‚
â”‚                                                     â”‚
â”‚  [âœï¸ Editar] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”˜
                                                    â”‚
                                    onClick         â”‚
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ EditProcessoDialog                              â”‚
â”‚                                                     â”‚
â”‚  Form (pre-populado):                              â”‚
â”‚  â€¢ Apelido: processo.apelido                       â”‚
â”‚  â€¢ Notificar: processo.notificar                   â”‚
â”‚                                                     â”‚
â”‚  ValidaÃ§Ã£o: editProcessoSchema (Zod)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ onSubmit â†’ PATCH /api/processos/[id]
                   â”‚ Body: { apelido, notificar }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ PATCH /api/processos/[id] (route.ts)           â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio                              â”‚
â”‚  2. Valida input com Zod                           â”‚
â”‚  3. Verifica ownership                             â”‚
â”‚  4. UPDATE user_processes                          â”‚
â”‚     SET apelido = ?, notificar = ?                 â”‚
â”‚     WHERE id = ? AND user_id = ?                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { processo: {...} }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ EditProcessoDialog                              â”‚
â”‚                                                     â”‚
â”‚  â€¢ toast.success("Atualizado!")                    â”‚
â”‚  â€¢ setOpen(false)                                  â”‚
â”‚  â€¢ onSuccess() â†’ fetchProcessos()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Lista atualizada
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ProcessosTable                                 â”‚
â”‚                                                     â”‚
â”‚  Mostra apelido/notificaÃ§Ã£o atualizados            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Fluxo de ExclusÃ£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ProcessosTable - Linha do processo             â”‚
â”‚                                                     â”‚
â”‚  [ğŸ—‘ï¸ Excluir] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”˜
                                                    â”‚
                                    onClick         â”‚
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ DeleteProcessoDialog (AlertDialog)              â”‚
â”‚                                                     â”‚
â”‚  ConfirmaÃ§Ã£o:                                       â”‚
â”‚  "Remover acompanhamento do processo               â”‚
â”‚   [numero]? Esta aÃ§Ã£o nÃ£o pode ser desfeita."      â”‚
â”‚                                                     â”‚
â”‚  [Cancelar]  [Remover]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ onClick Remover
                   â”‚ â†’ DELETE /api/processos/[id]
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ DELETE /api/processos/[id] (route.ts)          â”‚
â”‚                                                     â”‚
â”‚  1. Autentica usuÃ¡rio                              â”‚
â”‚  2. Verifica ownership                             â”‚
â”‚  3. DELETE FROM user_processes                     â”‚
â”‚     WHERE id = ? AND user_id = ?                   â”‚
â”‚                                                     â”‚
â”‚  NOTA: NÃ£o deleta de processes (tabela global)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Response: { success: true }
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ DeleteProcessoDialog                            â”‚
â”‚                                                     â”‚
â”‚  â€¢ toast.success("Processo removido!")             â”‚
â”‚  â€¢ setOpen(false)                                  â”‚
â”‚  â€¢ onSuccess() â†’ fetchProcessos()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Lista atualizada
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ProcessosTable                                 â”‚
â”‚                                                     â”‚
â”‚  Processo removido da lista                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Diagrama de Arquitetura Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE APRESENTAÃ‡ÃƒO                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  /dashboard/processos                  /dashboard/processos/[id] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Lista de processos â”‚             â”‚ â€¢ Detalhes completosâ”‚   â”‚
â”‚  â”‚ â€¢ Cards estatÃ­sticas â”‚             â”‚ â€¢ Timeline          â”‚   â”‚
â”‚  â”‚ â€¢ BotÃ£o adicionar    â”‚             â”‚ â€¢ Atualizar DataJud â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                      â”‚               â”‚
â”‚           â”‚ ProcessosTable                       â”‚               â”‚
â”‚           â”œâ”€ AddProcessoDialog                   â”‚               â”‚
â”‚           â”œâ”€ EditProcessoDialog                  â”‚               â”‚
â”‚           â””â”€ DeleteProcessoDialog                â”‚               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Fetch processos     â”‚        â”‚ Fetch processo   â”‚
         â”‚  Add/Edit/Delete     â”‚        â”‚ Atualizar        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE API                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  /api/processos                  /api/processos/[id]             â”‚
â”‚  â”œâ”€ GET (listar)                 â”œâ”€ GET (detalhes)               â”‚
â”‚  â””â”€ POST (adicionar)             â”œâ”€ PATCH (editar)               â”‚
â”‚                                  â”œâ”€ DELETE (remover)              â”‚
â”‚                                  â””â”€ /atualizar-datajud            â”‚
â”‚                                     â””â”€ POST                       â”‚
â”‚                                                                   â”‚
â”‚  Helpers:                                                         â”‚
â”‚  â”œâ”€ getAuthenticatedUser() âš ï¸ (nÃ£o existe, criar)               â”‚
â”‚  â”œâ”€ buscarDadosDataJud() âš ï¸ (duplicada)                         â”‚
â”‚  â””â”€ obterUrlTribunal()                                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Supabase Client     â”‚        â”‚ DataJud API      â”‚
         â”‚  Supabase Admin      â”‚        â”‚ âš ï¸ Key exposta   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE DADOS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Supabase PostgreSQL                                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  users           â”‚              â”‚  processes (global)   â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ id (PK)          â”‚              â”‚ id (PK)              â”‚     â”‚
â”‚  â”‚ auth_user_id     â”‚â—„â”€â”       â”Œâ”€â”€â”‚ numero (unique)      â”‚     â”‚
â”‚  â”‚ email            â”‚  â”‚       â”‚  â”‚ tribunal             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚  â”‚ partes (jsonb)       â”‚     â”‚
â”‚                        â”‚       â”‚  â”‚ movimentos (jsonb) âš ï¸â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚  â”‚ classe (jsonb)       â”‚     â”‚
â”‚  â”‚ user_processes   â”‚  â”‚       â”‚  â”‚ sistema (jsonb)      â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚       â”‚  â”‚ ...                  â”‚     â”‚
â”‚  â”‚ id (PK)          â”‚  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚ user_id (FK) â”€â”€â”€â”€â”¼â”€â”€â”˜       â”‚                               â”‚
â”‚  â”‚ process_id (FK) â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚  â”‚ apelido          â”‚                                           â”‚
â”‚  â”‚ notificar        â”‚                                           â”‚
â”‚  â”‚ criado_em        â”‚                                           â”‚
â”‚  â”‚ atualizado_em    â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legenda:
â”€â–º RelaÃ§Ã£o de chave estrangeira
âš ï¸ Ponto de atenÃ§Ã£o/problema
```

---

## 7. Problemas por Camada

### ğŸ–¥ï¸ Camada de ApresentaÃ§Ã£o

```
[ğŸ”´] Busca DataJud no cliente (page.tsx:79)
[ğŸŸ¡] Sem skeleton loaders adequados
[ğŸŸ¡] Sem filtros/busca
[ğŸŸ¡] Sem paginaÃ§Ã£o
```

### ğŸ”Œ Camada de API

```
[ğŸ”´] API key hardcoded (route.ts:27-28)
[ğŸ”´] FunÃ§Ã£o duplicada buscarDadosDataJud
[ğŸŸ¡] JOIN pesado com movimentos
[ğŸŸ¡] VerificaÃ§Ã£o de duplicata quebrada
[ğŸŸ¡] CÃ³digo de auth repetido
```

### ğŸ—„ï¸ Camada de Dados

```
[ğŸŸ¡] Campo movimentos pode ser muito grande
[ğŸŸ¢] RLS configurado corretamente
[ğŸŸ¢] Ãndices nas FKs
```

---

## 8. Fluxo Ideal (ApÃ³s RefatoraÃ§Ã£o)

```
Cliente                    API Server              DataJud API        Database
  â”‚                            â”‚                        â”‚                â”‚
  â”‚ Clica [Atualizar]          â”‚                        â”‚                â”‚
  â”œâ”€â”€â”€POST /atualizarâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                        â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚                            â”œâ”€â”€Busca API keyâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                            â”‚  de .env               â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚                            â”œâ”€â”€POST buscarâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                â”‚
  â”‚                            â”‚  processo              â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚                            â”‚â—„â”€â”€â”€â”€â”€Dadosâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚                            â”œâ”€â”€UPDATE processâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                            â”‚                        â”‚                â”‚
  â”‚â—„â”€â”€â”€â”€{success: true}â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚ Recarrega dados            â”‚                        â”‚                â”‚
  â”œâ”€â”€â”€GET /processos/[id]â”€â”€â”€â”€â”€â”€â–º                        â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚
  â”‚                            â”œâ”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                            â”‚                        â”‚                â”‚
  â”‚â—„â”€â”€â”€â”€{processo}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                â”‚
  â”‚                            â”‚                        â”‚                â”‚

âœ… API key segura no servidor
âœ… Cliente nunca acessa DataJud diretamente
âœ… Rate limiting aplicado no servidor
```

---

## ğŸ“Š Resumo de Endpoints

| MÃ©todo | Rota                                    | AutenticaÃ§Ã£o | Cache | Status                   |
| ------ | --------------------------------------- | ------------ | ----- | ------------------------ |
| GET    | `/api/processos`                        | âœ…           | âŒ    | ğŸŸ¡ JOIN pesado           |
| POST   | `/api/processos`                        | âœ…           | N/A   | ğŸŸ¡ VerificaÃ§Ã£o duplicata |
| GET    | `/api/processos/[id]`                   | âœ…           | âŒ    | âœ… OK                    |
| PATCH  | `/api/processos/[id]`                   | âœ…           | N/A   | âœ… OK                    |
| DELETE | `/api/processos/[id]`                   | âœ…           | N/A   | âœ… OK                    |
| POST   | `/api/processos/[id]/atualizar-datajud` | âœ…           | âŒ    | âœ… OK                    |

**Total:** 6 endpoints, 2 necessitam otimizaÃ§Ã£o
